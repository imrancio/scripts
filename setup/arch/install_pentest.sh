#!/bin/bash
BASEDIR=$(dirname $0)
# Install core pentesting tools
while true; do
	read -p $'\033[32m[1]\e[0m '"Install core pentest packages? [y/N] " yn
	case $yn in
		[Yy]* )
			# Arch pentest tools (+yay)
			sudo pacman -Sy --needed \
			hashcat \
			hashcat-utils \
			john \
			nmap \
			sqlmap \
			rkhunter \
			hydra \
			chntpw \
			aircrack-ng \
			create_ap \
			yay

			# AUR pentest tools
			yay -S --needed \
			burpsuite \
			samdump2
			break
			;;
		[Nn]* )
			break
			;;
		* )
			echo "Please answer yes or no"
			;;
	esac
done

# Install pentesting tools from BlackArch
while true; do
	read -p $'\033[32m[4]\e[0m '"Install BlackArch repo and tools? [y/N] " yn
	case $yn in
		[Yy]* )
			# check if repo not installed
			cat /etc/pacman.conf | grep -qF "[blackarch]"
			if [ $? -ne 0 ]; then
				# get BlackArch script
				wget https://blackarch.org/strap.sh
				# check shasum (current as of 22/11/18)
				diff <(sha1sum strap.sh) <(echo "9f770789df3b7803105e5fbc19212889674cd503  strap.sh")
				if [ $? -eq 0 ]; then
					# install BlackArch repo
					chmod +x strap.sh
					sudo ./strap.sh
					# upgrade new repo
					sudo pacman -Syyu
					# cleanup
					rm -f strap.sh
				else
					echo "SHA1 sum does not match or needs to be updated from https://blackarch.org/downloads.html#install-repo"
				fi
			fi

			# install blackarch pentesting tools
			sudo pacman -S --needed \
			blackarch/hashcat \
			blackarch/hashcat-utils \
			blackarch/john \
			blackarch/nmap \
			blackarch/sqlmap \
			blackarch/xsser \
			blackarch/rkhunter \
			blackarch/hydra \
			blackarch/burpsuite \
			blackarch-config-gtk

			# Add/update blackarch menus using 'blackmate' command
			if [ ! -d "/usr/share/blackmate" ]; then
				git clone https://github.com/imrancio/blackmate.git
				sudo mv blackmate /usr/share

				grep -qF "alias blackmate='sudo sh /usr/share/blackmate/blackmate.sh'" "${BASEDIR}/../zsh/aliases.zsh" ||
				echo "alias blackmate='sudo sh /usr/share/blackmate/blackmate.sh'" >> "${BASEDIR}/../zsh/aliases.zsh"
			fi

			sudo sh /usr/share/blackmate/blackmate.sh
			echo -e "\033[32m[*]\e[0m Run 'blackmate' to update BlackArch menus"
			break
			;;
		[Nn]* )
			break
			;;
		* )
			echo "Please answer yes or no "
			;;
	esac
done
